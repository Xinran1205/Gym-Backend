# ESæ•™ç»ƒæœç´¢ç³»ç»Ÿ - APIæµ‹è¯•æŒ‡å—

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†ä¸€ä¸ª**ä¼ä¸šçº§çš„ESæ•™ç»ƒæœç´¢åŠŸèƒ½**ï¼ŒåŒ…å«ï¼š
- âœ… **ç®€å•ä½†å®Œæ•´çš„æœç´¢é“¾è·¯**ï¼šå…³é”®è¯æœç´¢æ•™ç»ƒ
- âœ… **å®Œå–„çš„æ•°æ®åŒæ­¥æœºåˆ¶**ï¼šMySQLä¸ESæ•°æ®ä¸€è‡´æ€§ä¿è¯
- âœ… **ä¼ä¸šçº§ç‰¹æ€§**ï¼šå¼‚å¸¸å¤„ç†ã€æ—¥å¿—è®°å½•ã€ç›‘æ§åŸ‹ç‚¹
- âœ… **æ¼”ç¤ºæ•°æ®**ï¼šå¼€ç®±å³ç”¨çš„æµ‹è¯•æ•°æ®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨Elasticsearch
```bash
# ä½¿ç”¨Dockerå¯åŠ¨ESï¼ˆæ¨èï¼‰
docker run -d --name elasticsearch \
  -p 9200:9200 -p 9300:9300 \
  -e "discovery.type=single-node" \
  -e "ES_JAVA_OPTS=-Xms512m -Xmx512m" \
  elasticsearch:7.17.9
```

### 2. å¯åŠ¨åº”ç”¨
```bash
cd backend
mvn spring-boot:run
```

### 3. åˆå§‹åŒ–æ¼”ç¤ºæ•°æ®
```http
POST http://localhost:8080/api/es/demo/init
```

## ğŸ“‹ APIæ¥å£è¯¦æƒ…

### ğŸ”§ æ¼”ç¤ºæ•°æ®ç®¡ç†

#### åˆå§‹åŒ–æ¼”ç¤ºæ•°æ®
```http
POST /api/es/demo/init
Content-Type: application/json

å“åº”ç¤ºä¾‹ï¼š
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": "ESæ¼”ç¤ºæ•°æ®åˆå§‹åŒ–æˆåŠŸï¼Œå…±åˆ›å»º5æ¡æ•™ç»ƒæ•°æ®"
}
```

#### è·å–ç´¢å¼•ä¿¡æ¯
```http
GET /api/es/demo/info

å“åº”ç¤ºä¾‹ï¼š
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ", 
  "data": "ç´¢å¼•çŠ¶æ€: å­˜åœ¨, æ•°æ®æ¡æ•°: 5"
}
```

#### æ¸…ç†æ¼”ç¤ºæ•°æ®
```http
DELETE /api/es/demo/clean
```

### ğŸ” æ•™ç»ƒæœç´¢åŠŸèƒ½

#### 1. ç®€å•å…³é”®è¯æœç´¢ï¼ˆGETæ¥å£ï¼‰
```http
GET /api/es/trainers/search?keyword=å¼ æ•™ç»ƒ&page=1&size=10

å“åº”ç¤ºä¾‹ï¼š
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "trainers": [
      {
        "id": "demo_1",
        "userId": 1001,
        "name": "å¼ å¼ºæ•™ç»ƒ",
        "specializations": ["åŠ›é‡è®­ç»ƒ", "å¢è‚Œå‡è„‚"],
        "yearsOfExperience": 5,
        "biography": "ä¸“æ³¨åŠ›é‡è®­ç»ƒ5å¹´ï¼Œå¸®åŠ©100+å­¦å‘˜æˆåŠŸå¢è‚Œå‡è„‚",
        "workplace": "åŒ—äº¬å¥¥ä½“å¥èº«ä¸­å¿ƒ",
        "rating": 4.8,
        "reviewCount": 156,
        "isOnline": true,
        "location": {
          "latitude": 39.9042,
          "longitude": 116.4074,
          "address": "åŒ—äº¬å¥¥ä½“å¥èº«ä¸­å¿ƒ"
        }
      }
    ],
    "pageInfo": {
      "currentPage": 1,
      "pageSize": 10,
      "totalElements": 1,
      "totalPages": 1,
      "hasNext": false,
      "hasPrevious": false
    }
  }
}
```

#### 2. ç»¼åˆæœç´¢ï¼ˆPOSTæ¥å£ï¼‰
```http
POST /api/es/trainers/search
Content-Type: application/json

{
  "keyword": "ç‘œä¼½",
  "page": 1,
  "size": 10,
  "sortBy": "RATING",
  "sortDirection": "DESC"
}

å“åº”æ ¼å¼åŒä¸Š
```

#### 3. æœç´¢æµ‹è¯•ç”¨ä¾‹

**æµ‹è¯•ç”¨ä¾‹1ï¼šæœç´¢"åŠ›é‡"**
```http
GET /api/es/trainers/search?keyword=åŠ›é‡&page=1&size=5
```

**æµ‹è¯•ç”¨ä¾‹2ï¼šæœç´¢"ç‘œä¼½"**
```http
GET /api/es/trainers/search?keyword=ç‘œä¼½&page=1&size=5
```

**æµ‹è¯•ç”¨ä¾‹3ï¼šæœç´¢"æ•™ç»ƒ"**
```http
GET /api/es/trainers/search?keyword=æ•™ç»ƒ&page=1&size=5
```

**æµ‹è¯•ç”¨ä¾‹4ï¼šè·å–æ‰€æœ‰æ•™ç»ƒ**
```http
GET /api/es/trainers/search?page=1&size=10
```

### âš™ï¸ æ•°æ®åŒæ­¥ç®¡ç†

#### æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
```http
GET /api/es/trainers/consistency/check

å“åº”ç¤ºä¾‹ï¼š
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": "æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡ï¼Œæ•°æ®çŠ¶æ€è‰¯å¥½"
}
```

#### ä¿®å¤æ•°æ®ä¸ä¸€è‡´
```http
POST /api/es/trainers/consistency/repair

å“åº”ç¤ºä¾‹ï¼š
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": "æ•°æ®ä¸ä¸€è‡´ä¿®å¤å®Œæˆ"
}
```

#### åŒæ­¥å•ä¸ªæ•™ç»ƒæ•°æ®
```http
POST /api/es/trainers/sync/1001

å“åº”ç¤ºä¾‹ï¼š
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": "æ•™ç»ƒæ•°æ®åŒæ­¥æˆåŠŸ (ID: 1001)"
}
```

### ğŸ¥ å¥åº·æ£€æŸ¥

#### ESæœåŠ¡å¥åº·æ£€æŸ¥
```http
GET /api/es/trainers/health

å“åº”ç¤ºä¾‹ï¼š
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": "ESæœåŠ¡è¿è¡Œæ­£å¸¸ï¼Œç´¢å¼•ä¸­å…±æœ‰æ•™ç»ƒæ•°æ®5æ¡"
}
```

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### Step 1: ç¯å¢ƒæ£€æŸ¥
```bash
# æ£€æŸ¥ESæ˜¯å¦å¯åŠ¨
curl http://localhost:9200

# æ£€æŸ¥åº”ç”¨æ˜¯å¦å¯åŠ¨
curl http://localhost:8080/api/es/trainers/health
```

### Step 2: åˆå§‹åŒ–æ•°æ®
```bash
curl -X POST http://localhost:8080/api/es/demo/init
```

### Step 3: æµ‹è¯•æœç´¢åŠŸèƒ½
```bash
# æµ‹è¯•å…³é”®è¯æœç´¢
curl "http://localhost:8080/api/es/trainers/search?keyword=å¼ æ•™ç»ƒ"

# æµ‹è¯•ä¸“ä¸šæœç´¢
curl "http://localhost:8080/api/es/trainers/search?keyword=ç‘œä¼½"

# æµ‹è¯•åˆ†é¡µ
curl "http://localhost:8080/api/es/trainers/search?page=1&size=2"
```

### Step 4: æµ‹è¯•æ•°æ®åŒæ­¥
```bash
# æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
curl http://localhost:8080/api/es/trainers/consistency/check

# åŒæ­¥æ•°æ®
curl -X POST http://localhost:8080/api/es/trainers/sync/1001
```

## ğŸ“Š æ¼”ç¤ºæ•°æ®è¯´æ˜

ç³»ç»Ÿé¢„ç½®äº†5ä¸ªæ•™ç»ƒçš„æ¼”ç¤ºæ•°æ®ï¼š

1. **å¼ å¼ºæ•™ç»ƒ** - åŠ›é‡è®­ç»ƒä¸“å®¶ï¼ˆåŒ—äº¬å¥¥ä½“å¥èº«ä¸­å¿ƒï¼‰
2. **æç¾å¥³æ•™ç»ƒ** - ç‘œä¼½æ™®æ‹‰æä¸“å®¶ï¼ˆåŒ—äº¬ç‘œä¼½ç”Ÿæ´»é¦†ï¼‰  
3. **ç‹å¥æ•™ç»ƒ** - æœ‰æ°§å‡è„‚ä¸“å®¶ï¼ˆåŒ—äº¬å…¨æ°‘å¥èº«ä¸­å¿ƒï¼‰
4. **é™ˆå°æ˜æ•™ç»ƒ** - æ¸¸æ³³ä¸“å®¶ï¼ˆåŒ—äº¬æ°´ç«‹æ–¹æ¸¸æ³³é¦†ï¼‰
5. **èµµå¤§åŠ›æ•™ç»ƒ** - ä¸¾é‡ä¸“å®¶ï¼ˆåŒ—äº¬åŠ›é‡è®­ç»ƒåŸºåœ°ï¼‰

æ¯ä¸ªæ•™ç»ƒéƒ½åŒ…å«ï¼š
- åŸºæœ¬ä¿¡æ¯ï¼ˆå§“åã€ç»éªŒå¹´é™ï¼‰
- ä¸“ä¸šé¢†åŸŸ
- åœ°ç†ä½ç½®ï¼ˆåŒ—äº¬åœ°åŒºï¼‰
- è¯„åˆ†å’Œè¯„ä»·æ•°
- åœ¨çº¿çŠ¶æ€

## ğŸ” æœç´¢åŠŸèƒ½ç‰¹ç‚¹

### 1. å¤šå­—æ®µæœç´¢
- æ”¯æŒæŒ‰æ•™ç»ƒå§“åæœç´¢
- æ”¯æŒæŒ‰ä¸“ä¸šé¢†åŸŸæœç´¢
- æ”¯æŒæŒ‰è®¤è¯ä¿¡æ¯æœç´¢
- æ”¯æŒæŒ‰ä¸ªäººç®€ä»‹æœç´¢

### 2. æ™ºèƒ½æ’åº
- ç›¸å…³æ€§æ’åºï¼ˆé»˜è®¤ï¼‰
- è¯„åˆ†æ’åº
- ç»éªŒæ’åº

### 3. åˆ†é¡µæ”¯æŒ
- çµæ´»çš„åˆ†é¡µå‚æ•°
- å®Œæ•´çš„åˆ†é¡µä¿¡æ¯è¿”å›

## âš¡ ä¼ä¸šçº§ç‰¹æ€§

### 1. å¼‚å¸¸å¤„ç†
- ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- å‹å¥½çš„é”™è¯¯ä¿¡æ¯è¿”å›
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•

### 2. æ•°æ®ä¸€è‡´æ€§
- è‡ªåŠ¨æ•°æ®åŒæ­¥æœºåˆ¶
- å®šæ—¶ä¸€è‡´æ€§æ£€æŸ¥
- æ‰‹åŠ¨ä¿®å¤åŠŸèƒ½

### 3. ç›‘æ§å’Œæ—¥å¿—
- è¯¦ç»†çš„ä¸šåŠ¡æ—¥å¿—
- æ€§èƒ½ç›‘æ§åŸ‹ç‚¹
- æ“ä½œå®¡è®¡è®°å½•

### 4. é…ç½®ç®¡ç†
- çµæ´»çš„ESé…ç½®
- å¼€å…³æ§åˆ¶
- ç¯å¢ƒé€‚é…

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **ESç‰ˆæœ¬å…¼å®¹æ€§**ï¼šä½¿ç”¨ES 7.17.9ç‰ˆæœ¬
2. **å†…å­˜é…ç½®**ï¼šå»ºè®®ESåˆ†é…è‡³å°‘512MBå†…å­˜
3. **ç½‘ç»œè¿æ¥**ï¼šç¡®ä¿åº”ç”¨èƒ½è®¿é—®ESçš„9200ç«¯å£
4. **æ•°æ®æŒä¹…åŒ–**ï¼šæ¼”ç¤ºæ•°æ®å­˜å‚¨åœ¨ESä¸­ï¼Œé‡å¯ESä¼šä¸¢å¤±
5. **ç”Ÿäº§ç¯å¢ƒ**ï¼šæ¼”ç¤ºæ¥å£åº”åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç§»é™¤

## ğŸ“š å­¦ä¹ è¦ç‚¹

é€šè¿‡è¿™ä¸ªç³»ç»Ÿï¼Œæ‚¨å¯ä»¥å­¦ä¹ åˆ°ï¼š

1. **ESåŸºç¡€æ¦‚å¿µ**ï¼šç´¢å¼•ã€æ–‡æ¡£ã€æŸ¥è¯¢
2. **Spring Data ES**ï¼šRepositoryã€ElasticsearchOperations
3. **æ•°æ®åŒæ­¥**ï¼šMySQLä¸ESçš„æ•°æ®ä¸€è‡´æ€§
4. **ä¼ä¸šçº§å¼€å‘**ï¼šå¼‚å¸¸å¤„ç†ã€æ—¥å¿—è®°å½•ã€é…ç½®ç®¡ç†
5. **APIè®¾è®¡**ï¼šRESTfulæ¥å£ã€ç»Ÿä¸€å“åº”æ ¼å¼

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¼ä¸šçº§ESæœç´¢ç³»ç»Ÿçš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä¸“æ³¨äºæ ¸å¿ƒåŠŸèƒ½çš„å®ç°å’Œå­¦ä¹ ï¼

